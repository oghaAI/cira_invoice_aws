# Core OCR configuration
# Select OCR provider implementation. Currently supported: 'mistral'
OCR_PROVIDER=mistral

# Mistral OCR adapter configuration
# Base URL for the Mistral OCR API (https only)
MISTRAL_OCR_API_URL=https://mistral.example.com/ocr
# API key/token for Mistral OCR
MISTRAL_API_KEY=your-mistral-api-key
# Optional: debug URLs for OCR HTTP calls (prints method+URL)
OCR_DEBUG=0
# Optional: customize endpoint paths if your provider differs
# Path for creating an OCR job (POST). Default: jobs
MISTRAL_OCR_CREATE_PATH=jobs
# Path for checking job status (GET). You can use {id} placeholder. Default: jobs/{id}
MISTRAL_OCR_STATUS_PATH=jobs/{id}
# Sync mode options (for direct POST API like Mistral)
# Set to 'sync' to POST to base URL (optionally with sync path)
MISTRAL_OCR_MODE=sync
# If base URL doesn't include the path, set the sync path here (e.g., 'ocr' when base is https://api.mistral.ai/v1)
MISTRAL_OCR_SYNC_PATH=ocr
# Mistral OCR model name (sync mode)
MISTRAL_OCR_MODEL=mistral-ocr-latest
# Include image base64 in response (sync mode). Set to 0 to disable.
MISTRAL_INCLUDE_IMAGE_BASE64=1
# Mistral mode: set to 'sync' to POST directly to base URL (e.g., https://api.mistral.ai/v1/ocr)
MISTRAL_OCR_MODE=sync
# Mistral OCR model name (sync mode)
MISTRAL_OCR_MODEL=mistral-ocr-latest
# Include image base64 in response (sync mode). Set to 0 to disable.
MISTRAL_INCLUDE_IMAGE_BASE64=1

# PDF validation allowlist (comma-separated hostnames, no schemes)
# Examples: cloudfront distribution, S3 endpoints, etc.
ALLOWED_PDF_HOSTS=cloudfront.net,s3.amazonaws.com

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# Two modes available: RDS (AWS managed) or External Database (e.g., Supabase)

# Option 1: Use External Database (e.g., Supabase) - DEFAULT FOR DEV
# Set USE_EXTERNAL_DATABASE=true to skip RDS deployment and use external PostgreSQL
# This saves costs and speeds up development (no RDS provisioning time)
USE_EXTERNAL_DATABASE=true

# External database connection string (required when USE_EXTERNAL_DATABASE=true)
# Example Supabase: postgresql://postgres.projectref:password@aws-0-region.pooler.supabase.com:6543/postgres
# Example local: postgresql://postgres:password@localhost:5432/cira_invoice
DATABASE_URL=postgresql://postgres:password@localhost:5432/cira_invoice

# Option 2: Use AWS RDS (Production/Staging)
# Set USE_EXTERNAL_DATABASE=false to deploy RDS infrastructure
# These values are auto-injected by CDK during deployment, shown here for reference:
DATABASE_SECRET_ARN=arn:aws:secretsmanager:us-east-1:123456789012:secret:db/credentials-abc123
DATABASE_PROXY_ENDPOINT=db-proxy-xyz.proxy-abcdefghijkl.us-east-1.rds.amazonaws.com
DATABASE_NAME=cira_invoice

# Azure OpenAI (LLM extraction)
# Endpoint of your Azure OpenAI resource (e.g., https://my-aoai.openai.azure.com)
AZURE_OPENAI_ENDPOINT=https://your-azure-openai-resource.openai.azure.com
# API key for your Azure OpenAI resource
AZURE_OPENAI_API_KEY=your-azure-openai-api-key
# Deployment name of your GPT-4 model (e.g., gpt-4o-mini)
AZURE_OPENAI_DEPLOYMENT=gpt-4o-mini
# API version for Azure OpenAI
AZURE_OPENAI_API_VERSION=2024-08-01-preview

# Step Functions (optional for local tests)
# If set, API will attempt to start executions after job creation
WORKFLOW_STATE_MACHINE_ARN=arn:aws:states:us-east-1:123456789012:stateMachine:CiraInvoice-Workflow-dev

# Migration helper (one-off Lambda)
# Used by packages/infrastructure/src/migrations/run-schema.ts
SECRET_ARN=arn:aws:secretsmanager:us-east-1:123456789012:secret:db/credentials-abc123
DB_HOST=your-db.cluster-abcdefghijkl.us-east-1.rds.amazonaws.com
DB_NAME=cira_invoice

# CDK/AWS environment (deployment)
CDK_DEFAULT_ACCOUNT=123456789012
CDK_DEFAULT_REGION=us-east-1

# Standard AWS credentials are read by SDK/CLI if configured:
# AWS_ACCESS_KEY_ID=...
# AWS_SECRET_ACCESS_KEY=...
# AWS_SESSION_TOKEN=...

# API Testing Configuration (for test-api-workflow.js script)
# Get these values from CDK deployment outputs
API_BASE_URL=https://your-api-gateway-id.execute-api.us-east-1.amazonaws.com/dev
API_KEY=your-api-key-from-cdk-output

# Test PDF URL for integration testing (must be publicly accessible)
TEST_PDF_URL=https://example.com/sample-invoice.pdf

# Integration Test Control
# Set to 1 to run integration tests with real external services
RUN_OCR_INTEGRATION=0
